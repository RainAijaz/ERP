const { parseCookies, setCookie } = require("../utils/cookies");

const translations = {
  en: {
    brand: "CHAND EVA",
    dashboard: "Dashboard",
    welcome: "Welcome back. Select a module from the navigation to begin.",
    branch: "Branch",
    signed_in_as: "Signed in as",
    logout: "Logout",
    sign_in: "Sign in",
    use_credentials: "Use your ERP credentials to continue.",
    username: "Username",
    password: "Password",
    login: "Login",
    incorrect_credentials: "Incorrect username or password. Try again.",
    user_inactive: "User is inactive. Contact admin.",
    login_failed: "Login failed. Please try again.",
    administration: "Administration",
    setup: "Setup",
    branches: "Branches",
    users: "Users",
    roles: "Roles",
    permissions: "Permissions",
    approvals: "Pending Approvals",
    audit_logs: "Activity Log",
    master_data: "Master Data",
    accounts_parties: "Accounts & Parties",
    accounts: "Accounts",
    parties: "Parties",
    products: "Products",
    basic_information: "Basic Information",
    units: "Units",
    groups: "Groups",
    sizes: "Sizes",
    colors: "Colors",
    grades: "Grades",
    packing_types: "Packing Types",
    finished: "Finished",
    semi_finished: "Semi-Finished",
    raw_materials: "Raw Materials",
    skus: "SKUs",
    bom: "BOM",
    bom_list: "BOM List",
    bom_versions: "Versions",
    bom_approval: "Approval",
    hr_payroll: "HR & Payroll",
    employees: "Employees",
    sales_commission: "Sales Commission",
    allowances: "Allowances",
    labours: "Labours",
    labour_rates: "Labour Rates",
    financial: "Financial",
    vouchers: "Vouchers",
    cash_voucher: "Cash Voucher",
    bank_voucher: "Bank Voucher",
    journal_voucher: "Journal Voucher",
    reports: "Reports",
    financial_reports: "Financial Reports",
    purchase: "Purchase",
    purchase_invoice: "Purchase Invoice",
    purchase_order: "Purchase Order",
    purchase_return: "Purchase Return",
    purchase_reports: "Purchase Report",
    production: "Production",
    abnormal_loss: "Abnormal Loss",
    production_reports: "Production Reports",
    inventory: "Inventory",
    inventory_voucher: "Inventory Voucher",
    stock_count: "Stock Count",
    stock_transfer: "Stock Transfer",
    inventory_reports: "Inventory Reports",
    outward_returnable: "Outward & Returnable",
    returnables: "Returnables",
    returnable_reports: "Returnable Reports",
    sales: "Sales",
    sales_voucher: "Sales Voucher",
    sales_order: "Sales Order",
    sales_reports: "Sales Reports",
    language: "Language",
    english: "English",
    urdu: "Urdu",
  },
  ur: {
    brand: "چاند ایوا",
    dashboard: "ڈیش بورڈ",
    welcome: "خوش آمدید۔ شروع کرنے کے لئے نیویگیشن سے ماڈیول منتخب کریں۔",
    branch: "برانچ",
    signed_in_as: "بطور داخل",
    logout: "لاگ آؤٹ",
    sign_in: "سائن اِن",
    use_credentials: "جاری رکھنے کے لیے اپنی ERP اسناد استعمال کریں۔",
    username: "صارف نام",
    password: "پاس ورڈ",
    login: "لاگ اِن",
    incorrect_credentials: "غلط صارف نام یا پاس ورڈ۔ دوبارہ کوشش کریں۔",
    user_inactive: "صارف غیر فعال ہے۔ ایڈمن سے رابطہ کریں۔",
    login_failed: "لاگ اِن ناکام۔ دوبارہ کوشش کریں۔",
    administration: "انتظامیہ",
    setup: "سیٹ اپ",
    branches: "برانچز",
    users: "صارفین",
    roles: "رولز",
    permissions: "اجازتیں",
    approvals: "زیر التواء منظوری",
    audit_logs: "سرگرمی لاگ",
    master_data: "ماسٹر ڈیٹا",
    accounts_parties: "اکاؤنٹس اور پارٹیز",
    accounts: "اکاؤنٹس",
    parties: "پارٹیز",
    products: "مصنوعات",
    basic_information: "بنیادی معلومات",
    units: "یونٹس",
    groups: "گروپس",
    sizes: "سائزز",
    colors: "رنگ",
    grades: "گریڈز",
    packing_types: "پیکنگ ٹائپس",
    finished: "فنشڈ",
    semi_finished: "سیمی فنشڈ",
    raw_materials: "خام مال",
    skus: "ایس کے یو",
    bom: "بی او ایم",
    bom_list: "بی او ایم فہرست",
    bom_versions: "ورژنز",
    bom_approval: "منظوری",
    hr_payroll: "ایچ آر اور پے رول",
    employees: "ملازمین",
    sales_commission: "سیلز کمیشن",
    allowances: "الاؤنسز",
    labours: "لیبرز",
    labour_rates: "لیبر ریٹس",
    financial: "مالیاتی",
    vouchers: "ووچرز",
    cash_voucher: "کیش ووچر",
    bank_voucher: "بینک ووچر",
    journal_voucher: "جرنل ووچر",
    reports: "رپورٹس",
    financial_reports: "مالیاتی رپورٹس",
    purchase: "خریداری",
    purchase_invoice: "خریداری انوائس",
    purchase_order: "خریداری آرڈر",
    purchase_return: "خریداری ریٹرن",
    purchase_reports: "خریداری رپورٹس",
    production: "پروڈکشن",
    abnormal_loss: "غیر معمولی نقصان",
    production_reports: "پروڈکشن رپورٹس",
    inventory: "انوینٹری",
    inventory_voucher: "انوینٹری ووچر",
    stock_count: "اسٹاک کاؤنٹ",
    stock_transfer: "اسٹاک ٹرانسفر",
    inventory_reports: "انوینٹری رپورٹس",
    outward_returnable: "آؤٹ ورڈ اور ریٹرنیبل",
    returnables: "ریٹرنیبلز",
    returnable_reports: "ریٹرنیبل رپورٹس",
    sales: "سیلز",
    sales_voucher: "سیلز ووچر",
    sales_order: "سیلز آرڈر",
    sales_reports: "سیلز رپورٹس",
    language: "زبان",
    english: "انگریزی",
    urdu: "اردو",
  },
};

// Resolves locale (Urdu/English) and exposes it to views/responses.
module.exports = (req, res, next) => {
  const cookies = parseCookies(req);
  const requested = (req.query && req.query.lang) || cookies.lang || (req.headers["accept-language"] || "").split(",")[0];
  const normalized = (requested || "en").toLowerCase();
  const locale = normalized.startsWith("ur") ? "ur" : "en";

  if (req.query && req.query.lang) {
    setCookie(res, "lang", locale, {
      path: "/",
      sameSite: "Lax",
      maxAge: 60 * 60 * 24 * 365,
    });
  }

  req.locale = locale;
  res.locals.locale = locale;
  res.locals.t = (key) => translations[locale][key] || translations.en[key] || key;
  next();
};
