<div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
  <h3 class="text-lg font-semibold leading-6 text-slate-900 mb-4"><%= title %></h3>
  <form action="/administration/users/save" method="POST" class="space-y-5" autocomplete="off" data-translate-mode="transliterate">
    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
    <input type="hidden" name="id" value="<%= user ? user.id : '' %>">
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-slate-700 mb-1"><%= t('name') || 'Name' %> *</label>
        <input type="text" name="name" value="<%= user ? user.name : '' %>" required autocomplete="off" class="w-full rounded-lg border-slate-300 focus:ring-accent focus:border-accent">
      </div>
      <div>
        <label class="block text-sm font-medium text-slate-700 mb-1"><%= t('name_ur') || 'Name (Urdu)' %></label>
        <input type="text" name="name_ur" value="<%= user ? user.name_ur : '' %>" autocomplete="off" class="w-full rounded-lg border-slate-300 focus:ring-accent focus:border-accent">
      </div>
      <div>
        <label class="block text-sm font-medium text-slate-700 mb-1"><%= t('username') %> *</label>
        <input type="text" name="username" value="<%= user ? user.username : '' %>" required autocomplete="off" autocapitalize="off" spellcheck="false" class="w-full rounded-lg border-slate-300 focus:ring-accent focus:border-accent">
      </div>
      <div>
        <label class="block text-sm font-medium text-slate-700 mb-1"><%= t('password') %> <%= user ? t('leave_blank_keep') : '*' %></label>
        <input type="password" name="password" <%= user ? '' : 'required' %> autocomplete="new-password" autocapitalize="off" spellcheck="false" class="w-full rounded-lg border-slate-300 focus:ring-accent focus:border-accent">
      </div>
      <div>
        <label class="block text-sm font-medium text-slate-700 mb-1"><%= t('email') %></label>
        <input type="email" name="email" value="<%= user ? user.email : '' %>" class="w-full rounded-lg border-slate-300 focus:ring-accent focus:border-accent">
      </div>
      <div>
        <label class="block text-sm font-medium text-slate-700 mb-1"><%= t('role') %> *</label>
        <select name="primary_role_id" required class="w-full rounded-lg border-slate-300 focus:ring-accent focus:border-accent">
          <option value=""><%= t('select_role') %></option>
          <% roles.forEach(r => { %>
            <option value="<%= r.id %>" <%= user && user.primary_role_id == r.id ? 'selected' : '' %>><%= r.name %></option>
          <% }) %>
        </select>
      </div>
    </div>

    <div>
      <label class="block text-sm font-medium text-slate-700 mb-2"><%= t('assigned_branches') %></label>
      <p class="mb-3 text-xs text-slate-500"><%= t('branch_access_hint') %></p>
      <div class="space-y-2" data-multi-select>
        <button
          type="button"
          class="flex w-full items-center justify-between rounded-xl border border-slate-200 bg-white px-4 py-3 text-left text-sm text-slate-700 shadow-sm transition hover:border-slate-300 hover:text-slate-900 focus:outline-none focus:ring-2 focus:ring-accent/30"
          data-multi-trigger
        >
          <span data-multi-placeholder><%= t('select') %></span>
          <svg class="h-4 w-4 text-slate-400" viewBox="0 0 20 20" fill="none" aria-hidden="true">
            <path d="M5 7l5 6 5-6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
        </button>
        <div class="flex flex-wrap gap-2" data-multi-tags></div>
        <div class="hidden max-h-48 w-full overflow-auto rounded-xl border border-slate-200 bg-white p-2 shadow-md" data-multi-menu></div>
        <select class="sr-only" name="branch_ids" multiple>
          <% allBranches.forEach(b => { %>
            <option value="<%= b.id %>" <%= userBranches.includes(Number(b.id)) ? 'selected' : '' %>><%= b.name %></option>
          <% }) %>
        </select>
      </div>
    </div>

    <div class="mt-5 sm:mt-6 sm:grid sm:grid-flow-row-dense sm:grid-cols-2 sm:gap-3">
      <button type="submit" class="inline-flex w-full justify-center rounded-md bg-accent px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-accent/90 sm:col-start-2">
        <%= t('save') %>
      </button>
      <button type="button" onclick="document.getElementById('modal-backdrop').classList.add('hidden'); document.getElementById('modal-shell').classList.add('hidden');" class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-slate-900 shadow-sm ring-1 ring-inset ring-slate-300 hover:bg-slate-50 sm:col-start-1 sm:mt-0">
        <%= t('cancel') %>
      </button>
    </div>
  </form>
</div>
<%- include("../../base/partials/urdu-translate-utils") %>
