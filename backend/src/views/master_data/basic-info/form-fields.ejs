<% const hideCode = ["accounts", "parties"].includes(page.titleKey); %>
<% page.fields.forEach(function(field) { %>
  <% const hideOnCreate = page.titleKey === "parties" && (field.name === "credit_allowed" || field.name === "credit_limit"); %>
  <% if (field.adminOnly && !isAdmin) { return; } %>
  <% if (hideCode && field.name === "code") { return; } %>
  <% if (field.type === "checkbox") { %>
    <label class="flex flex-1 items-start gap-3 rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm font-semibold text-slate-600" <%= hideOnCreate ? "data-hide-on-create=\"true\"" : "" %>>
      <input class="mt-0.5 h-4 w-4 rounded border-slate-300 text-accent focus:ring-accent/40" type="checkbox" name="<%= field.name %>" data-field="<%= field.name %>" />
      <span class="flex flex-col gap-1">
        <span><%= t(field.label) %></span>
        <% if (field.helpText) { %>
          <span class="text-xs font-normal text-slate-500"><%= t(field.helpText) %></span>
        <% } %>
      </span>
    </label>
  <% } else if (field.type === "select") { %>
    <label class="block text-sm font-semibold text-slate-600" <%= hideOnCreate ? "data-hide-on-create=\"true\"" : "" %>>
      <span><%= t(field.label) %></span>
      <% if (field.helpText) { %>
        <span class="block text-xs font-normal text-slate-500"><%= t(field.helpText) %></span>
      <% } %>
      <select class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-700 shadow-sm focus:outline-none focus:ring-2 focus:ring-accent/30" name="<%= field.name %>" data-field="<%= field.name %>" <%= field.required ? "required" : "" %>>
        <option value=""><%= t("select_option") %></option>
        <% (field.options || []).forEach(function(option) { %>
          <option value="<%= option.value %>"><%= option.label %></option>
        <% }) %>
      </select>
    </label>
  <% } else if (field.type === "textarea") { %>
    <label class="block text-sm font-semibold text-slate-600" <%= hideOnCreate ? "data-hide-on-create=\"true\"" : "" %>>
      <span><%= t(field.label) %></span>
      <% if (field.helpText) { %>
        <span class="block text-xs font-normal text-slate-500"><%= t(field.helpText) %></span>
      <% } %>
      <textarea class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-700 shadow-sm focus:outline-none focus:ring-2 focus:ring-accent/30" name="<%= field.name %>" data-field="<%= field.name %>" rows="<%= field.rows || 3 %>" placeholder="<%= field.placeholder ? t(field.placeholder) : "" %>" <%= field.required ? "required" : "" %>></textarea>
    </label>
  <% } else if (field.type === "multi-select") { %>
    <label class="block text-sm font-semibold text-slate-600" <%= hideOnCreate ? "data-hide-on-create=\"true\"" : "" %>>
      <span><%= t(field.label) %></span>
      <% if (field.helpText) { %>
        <span class="block text-xs font-normal text-slate-500"><%= t(field.helpText) %></span>
      <% } %>
      <div class="mt-2" data-multi-select data-field="<%= field.name %>">
        <div class="flex items-center gap-2">
          <button class="flex-1 rounded-xl border border-slate-200 bg-white px-4 py-3 text-left text-sm text-slate-700 shadow-sm transition hover:border-slate-300" type="button" data-multi-toggle>
            <span data-multi-placeholder><%= t("select_option") %></span>
          </button>
        </div>
        <div class="relative">
          <div class="mt-2 hidden w-full rounded-xl border border-slate-200 bg-white p-2 shadow-lg" data-multi-menu>
            <% (field.options || []).forEach(function(option) { %>
              <label class="flex items-center gap-2 rounded-lg px-2 py-1 text-xs font-semibold text-slate-700 hover:bg-slate-50">
                <input class="h-4 w-4 rounded border-slate-300 text-accent focus:ring-accent/40" type="checkbox" value="<%= option.value %>" />
                <span><%= option.label %></span>
              </label>
            <% }) %>
          </div>
        </div>
        <div class="mt-2 flex flex-wrap gap-2" data-multi-tags></div>
        <input type="hidden" name="<%= field.name %>" data-multi-input />
      </div>
    </label>
  <% } else if (field.type === "multi-checkbox") { %>
    <div class="rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm font-semibold text-slate-600" <%= hideOnCreate ? "data-hide-on-create=\"true\"" : "" %>>
      <div class="flex flex-col gap-1">
        <span><%= t(field.label) %></span>
        <% if (field.helpText) { %>
          <span class="text-xs font-normal text-slate-500"><%= t(field.helpText) %></span>
        <% } %>
      </div>
      <div class="mt-3 flex flex-wrap gap-3">
        <% (field.options || []).forEach(function(option) { %>
          <label class="flex items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-2 text-xs font-semibold uppercase tracking-[0.12em] text-slate-600">
            <input
              class="h-4 w-4 rounded border-slate-300 text-accent focus:ring-accent/40"
              type="checkbox"
              name="<%= field.name %>"
              value="<%= option.value %>"
              data-field="<%= field.name %>"
              data-multi="true"
            />
            <span><%= t(option.label) %></span>
          </label>
        <% }) %>
      </div>
    </div>
  <% } else { %>
    <label class="block text-sm font-semibold text-slate-600" <%= hideOnCreate ? "data-hide-on-create=\"true\"" : "" %>>
      <span><%= t(field.label) %></span>
      <% if (field.helpText) { %>
        <span class="block text-xs font-normal text-slate-500"><%= t(field.helpText) %></span>
      <% } %>
      <input class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-700 shadow-sm focus:outline-none focus:ring-2 focus:ring-accent/30" type="<%= field.type || "text" %>" name="<%= field.name %>" placeholder="<%= field.placeholder ? t(field.placeholder) : "" %>" data-field="<%= field.name %>" <%= field.required ? "required" : "" %> />
    </label>
  <% } %>
<% }) %>
