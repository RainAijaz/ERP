<div class="mx-auto w-full max-w-7xl space-y-6">
  <section class="rounded-3xl border border-slate-200 bg-white/95 p-6 shadow-lg">
    <div class="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">
      <div class="space-y-1">
        <h1 class="text-2xl font-display text-ink"><%= t(page.titleKey) %></h1>
        <p class="text-sm text-muted"><%= t(page.description) %></p>
      </div>
      <div class="flex flex-wrap gap-2">
        <button class="cursor-pointer rounded-full border border-slate-200 bg-white px-4 py-2 text-xs font-semibold uppercase tracking-[0.2em] text-slate-600 transition hover:border-slate-300 hover:text-slate-800" type="button" data-download-button>
          <%= t("download") %>
        </button>
        <button class="cursor-pointer rounded-full border border-slate-200 bg-white px-4 py-2 text-xs font-semibold uppercase tracking-[0.2em] text-slate-600 transition hover:border-slate-300 hover:text-slate-800" type="button" data-print-button>
          <%= t("print") %>
        </button>
        <button class="cursor-pointer rounded-full bg-slate-900 px-4 py-2 text-xs font-semibold uppercase tracking-[0.2em] text-white shadow-sm transition hover:bg-slate-800" type="button" data-modal-open style="color: #fff;">
          <%= t("add") %> <%= t(page.titleKey) %>
        </button>
      </div>
    </div>
  </section>

  <% if (error) { %>
    <div class="rounded-2xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700">
      <%= error %>
    </div>
  <% } %>

  <section class="rounded-2xl border border-slate-200 bg-white/95 shadow-md" data-print-area>
    <div class="px-5 pt-4 text-center text-xl font-display font-semibold uppercase tracking-[0.35em] text-slate-900" data-print-header>
      <%= t("brand") %>
    </div>
    <div class="flex flex-col gap-3 border-b border-slate-200 px-5 py-4 sm:flex-row sm:items-center sm:justify-between">
      <div class="text-sm font-semibold text-slate-700"><%= t("list") %> <%= t(page.titleKey) %></div>
      <div class="flex flex-wrap items-center gap-3 text-xs text-slate-500">
        <label class="flex items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1.5 shadow-sm">
          <span class="text-[10px] uppercase tracking-[0.2em] text-slate-400"><%= t("show") %></span>
          <select class="bg-transparent text-xs font-semibold text-slate-700 focus:outline-none cursor-pointer" data-page-size>
            <option>10</option>
            <option>25</option>
            <option>50</option>
            <option value="all"><%= t("all") %></option>
          </select>
          <span class="text-[10px] uppercase tracking-[0.2em] text-slate-400"><%= t("rows") %></span>
        </label>
        <label class="flex items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1.5 shadow-sm">
          <span class="text-[10px] uppercase tracking-[0.2em] text-slate-400"><%= t("status") %></span>
          <select class="bg-transparent text-xs font-semibold text-slate-700 focus:outline-none cursor-pointer" data-status-filter>
            <option value="all"><%= t("all") %></option>
            <option value="active"><%= t("active") %></option>
            <option value="inactive"><%= t("inactive") %></option>
          </select>
        </label>
        <label class="flex items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1.5 shadow-sm">
          <svg class="h-4 w-4 text-slate-400" viewBox="0 0 20 20" fill="none" aria-hidden="true">
            <path d="M9 15a6 6 0 1 1 4.24-1.76L17 17" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
          </svg>
          <input class="w-36 bg-transparent text-xs font-semibold text-slate-700 focus:outline-none" type="text" placeholder="<%= t("search") %>" data-search-input />
        </label>
      </div>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm" data-table>
        <thead class="bg-slate-50 text-xs font-semibold uppercase tracking-[0.1em] text-slate-500">
          <% const columnTooltips = {
            account_type: t("tooltip_account_type"),
            code: t("tooltip_code"),
            is_contra: t("tooltip_contra")
          }; 
          const itemTypeLabels = {
            RM: t("raw_materials"),
            SFG: t("semi_finished_goods"),
            FG: t("finished_goods")
          };
          const formatItemTypes = function(value) {
            return (value || "")
              .split(",")
              .map(function(entry) { return entry.trim(); })
              .filter(Boolean)
              .map(function(entry) { return itemTypeLabels[entry] || entry; })
              .join(", ");
          };
          %>
          <tr>
            <th class="px-4 py-3 text-left"><%= t("sr_no") %></th>
            <% const displayColumns = page.columns.filter(function(column) { return column.key !== "id" && !(column.key === "name_ur" && locale !== "ur") && !(column.key === "name" && locale === "ur"); }); %>
            <% displayColumns.forEach(function(column, idx) { %>
              <% const sortType = (column.key.includes("date") || column.key.includes("time")) ? "date" : "text"; %>
              <th class="px-4 py-3 text-left">
                <button
                  class="group inline-flex items-center gap-1 text-left text-xs font-semibold uppercase tracking-[0.1em] text-slate-500 transition hover:text-slate-700 cursor-pointer"
                  type="button"
                  data-sort-key="<%= column.key %>"
                  data-sort-index="<%= idx + 1 %>"
                  data-sort-type="<%= sortType %>"
                  <%= columnTooltips[column.key] ? "title=\"" + columnTooltips[column.key] + "\"" : "" %>
                >
                  <span><%= t(column.label) %></span>
                  <span class="text-[10px] opacity-60" data-sort-indicator>-</span>
                </button>
              </th>
            <% }) %>
            <th class="px-4 py-3 text-left"><%= t("actions") %></th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-100" data-table-body>
          <% if (!rows || rows.length === 0) { %>
            <tr>
              <td class="px-4 py-4 text-slate-500" colspan="<%= displayColumns.length + 2 %>"><%= t("no_entries") %></td>
            </tr>
          <% } else { %>
            <% rows.forEach(function(row, idx) { %>
              <tr class="hover:bg-amber-50/40" data-row data-code="<%= row.code || "" %>" data-active="<%= row.is_active ? "true" : "false" %>">
                <td class="px-4 py-3 text-slate-700"><%= idx + 1 %></td>
                <% displayColumns.forEach(function(column) { %>
                  <td class="px-4 py-3 text-slate-700" <%= column.key === "created_at" && row[column.key] ? "data-sort-value=\"" + new Date(row[column.key]).toISOString() + "\"" : "" %>>
                    <% if (column.type === "boolean") { %>
                      <span class="inline-flex items-center rounded-full border border-slate-200 px-2.5 py-1 text-[11px] font-semibold uppercase tracking-[0.15em] text-slate-600">
                        <%= row[column.key] ? t("yes") : t("no") %>
                      </span>
                    <% } else if (column.key === "group_name") { %>
                      <%= row[column.key] ? row[column.key] : t("none") %>
                    <% } else if (column.key === "item_types") { %>
                      <%= formatItemTypes(row[column.key]) %>
                    <% } else if (column.key === "created_at") { %>
                      <%= row[column.key] ? new Date(row[column.key]).toISOString().slice(0, 10) : "" %>
                    <% } else { %>
                      <%= row[column.key] %>
                    <% } %>
                  </td>
                <% }) %>
                <td class="px-4 py-3">
                  <div class="flex items-center gap-2">
                    <button
                      class="inline-flex items-center justify-center rounded-md border border-slate-200 bg-white p-2 text-slate-600 transition hover:border-slate-300 hover:text-slate-900 cursor-pointer"
                      type="button"
                      data-edit
                      data-id="<%= row.id %>"
                      title="<%= t("edit") %>"
                      <% page.fields.forEach(function(field) { %>
                        data-<%= field.name %>="<%= row[field.name] === null || row[field.name] === undefined ? "" : row[field.name] %>"
                      <% }) %>
                      data-created-at="<%= row.created_at ? new Date(row.created_at).toISOString() : "" %>"
                      data-created-by="<%= row.created_by_name || "" %>"
                      data-updated-at="<%= row.updated_at ? new Date(row.updated_at).toISOString() : "" %>"
                      data-updated-by="<%= row.updated_by_name || "" %>"
                    >
                      <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                        <path d="M12 20h9" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                        <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
                      </svg>
                    </button>
                    <button
                      class="inline-flex items-center justify-center rounded-md border border-slate-200 bg-white p-2 text-slate-600 transition hover:border-slate-300 hover:text-slate-900 cursor-pointer"
                      type="button"
                      data-toggle
                      data-toggle-action="<%= basePath %>/<%= row.id %>/toggle"
                      data-toggle-label="<%= row.is_active ? t("deactivate") : t("activate") %>"
                      title="<%= row.is_active ? t("deactivate") : t("activate") %>"
                    >
                      <% if (row.is_active) { %>
                        <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                          <path d="M6 12h12" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                        </svg>
                      <% } else { %>
                        <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                          <path d="M12 5v14" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                          <path d="M5 12h14" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                        </svg>
                      <% } %>
                    </button>
                    <button
                      class="inline-flex items-center justify-center rounded-md border border-rose-200 bg-rose-50 p-2 text-rose-600 transition hover:border-rose-300 hover:text-rose-700 cursor-pointer"
                      type="button"
                      data-delete
                      data-delete-action="<%= basePath %>/<%= row.id %>/delete"
                      title="<%= t("permanent_delete") %>"
                    >
                      <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                        <path d="M4 7h16" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                        <path d="M9 7V5h6v2" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                        <path d="M10 11v6M14 11v6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                        <path d="M6 7l1 13h10l1-13" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
                      </svg>
                    </button>
                  </div>
                </td>
              </tr>
            <% }) %>
          <% } %>
        </tbody>
      </table>
    </div>
    <div class="flex flex-col gap-3 border-t border-slate-200 px-5 py-3 text-xs text-slate-500 sm:flex-row sm:items-center sm:justify-between">
        <span data-showing-count><%= t("showing") %> 0</span>
        <div class="flex items-center gap-2">
          <button class="rounded border border-slate-200 px-2 py-1 text-slate-500 cursor-pointer" type="button" data-prev-page><%= t("prev") %></button>
          <button class="rounded bg-slate-900 px-2 py-1 text-white cursor-pointer" type="button" data-page-indicator>1</button>
          <button class="rounded border border-slate-200 px-2 py-1 text-slate-500 cursor-pointer" type="button" data-next-page><%= t("next") %></button>
      </div>
    </div>
  </section>
</div>

<div
  class="fixed inset-0 z-50 hidden items-center justify-center bg-slate-900/40 p-4"
  data-modal
  data-auto-open="<%= modalOpen ? "true" : "false" %>"
  data-modal-mode="<%= modalMode || "create" %>"
>
  <div class="w-full max-w-lg rounded-2xl border border-slate-200 bg-white shadow-xl">
    <div class="flex items-center justify-between border-b border-slate-200 px-6 py-4">
      <div>
        <div class="text-sm font-semibold text-slate-700" data-modal-title><%= t("add") %> <%= t(page.titleKey) %></div>
        <p class="text-xs text-slate-500"><%= t("enter_details_save") %></p>
      </div>
      <button class="rounded-full border border-slate-200 p-2 text-slate-500 transition hover:text-slate-700 cursor-pointer" type="button" data-modal-close>
        <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M6 6l12 12M6 18L18 6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
        </svg>
      </button>
    </div>
    <form method="post" action="<%= basePath %>" class="space-y-5 px-6 py-5" data-modal-form data-translate-mode="<%= page.translateMode || "translate" %>">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
      <% page.fields.forEach(function(field) { %>
        <% if (field.type === "checkbox") { %>
          <label class="flex flex-1 items-start gap-3 rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm font-semibold text-slate-600">
            <input class="mt-0.5 h-4 w-4 rounded border-slate-300 text-accent focus:ring-accent/40" type="checkbox" name="<%= field.name %>" data-field="<%= field.name %>" />
            <span class="flex flex-col gap-1">
              <span><%= t(field.label) %></span>
              <% if (field.helpText) { %>
                <span class="text-xs font-normal text-slate-500"><%= t(field.helpText) %></span>
              <% } %>
            </span>
          </label>
        <% } else if (field.type === "select") { %>
          <label class="block text-sm font-semibold text-slate-600">
            <span><%= t(field.label) %></span>
            <% if (field.helpText) { %>
              <span class="mt-1 block text-xs font-normal text-slate-500"><%= t(field.helpText) %></span>
            <% } %>
            <select
              class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-700 shadow-sm focus:outline-none focus:ring-2 focus:ring-accent/30"
              name="<%= field.name %>"
              data-field="<%= field.name %>"
              <%= field.required ? "required" : "" %>
            >
              <option value=""><%= t("select") %></option>
              <% (field.options || []).forEach(function(option) { %>
                <option value="<%= option.value %>"><%= t(option.label) %></option>
              <% }) %>
            </select>
          </label>
        <% } else if (field.type === "multi-select") { %>
          <label class="block text-sm font-semibold text-slate-600">
            <span><%= t(field.label) %></span>
            <% if (field.helpText) { %>
              <span class="mt-1 block text-xs font-normal text-slate-500"><%= t(field.helpText) %></span>
            <% } %>
            <select
              class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-700 shadow-sm focus:outline-none focus:ring-2 focus:ring-accent/30"
              name="<%= field.name %>"
              data-field="<%= field.name %>"
              multiple
              <%= field.required ? "required" : "" %>
            >
              <% (field.options || []).forEach(function(option) { %>
                <option value="<%= option.value %>"><%= t(option.label) %></option>
              <% }) %>
            </select>
          </label>
        <% } else if (field.type === "multi-checkbox") { %>
          <div class="rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm font-semibold text-slate-600">
            <div class="flex flex-col gap-1">
              <span><%= t(field.label) %></span>
              <% if (field.helpText) { %>
                <span class="text-xs font-normal text-slate-500"><%= t(field.helpText) %></span>
              <% } %>
            </div>
            <div class="mt-3 flex flex-wrap gap-3">
              <% (field.options || []).forEach(function(option) { %>
                <label class="flex items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-2 text-xs font-semibold uppercase tracking-[0.12em] text-slate-600">
                  <input
                    class="h-4 w-4 rounded border-slate-300 text-accent focus:ring-accent/40"
                    type="checkbox"
                    name="<%= field.name %>"
                    value="<%= option.value %>"
                    data-field="<%= field.name %>"
                    data-multi="true"
                  />
                  <span><%= t(option.label) %></span>
                </label>
              <% }) %>
            </div>
          </div>
        <% } else { %>
          <label class="block text-sm font-semibold text-slate-600">
            <span><%= t(field.label) %></span>
            <% if (page.titleKey === "units" && field.name === "code") { %>
              <span class="mt-1 block text-xs font-normal text-slate-500"><%= t("help_unit_code") %></span>
            <% } %>
            <% if (page.titleKey === "units" && field.name === "name") { %>
              <span class="mt-1 block text-xs font-normal text-slate-500"><%= t("help_unit_name") %></span>
            <% } %>
            <% if (field.helpText) { %>
              <span class="mt-1 block text-xs font-normal text-slate-500"><%= t(field.helpText) %></span>
            <% } %>
            <input
              class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-700 shadow-sm focus:outline-none focus:ring-2 focus:ring-accent/30"
              type="text"
              name="<%= field.name %>"
              placeholder="<%= field.placeholder ? t(field.placeholder) : "" %>"
              data-field="<%= field.name %>"
              <%= field.required ? "required" : "" %>
            />
          </label>
        <% } %>
      <% }) %>
      <div class="rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-xs text-slate-600" data-audit-panel hidden>
        <div class="font-semibold text-slate-700"><%= t("audit") %></div>
        <div class="mt-1"><%= t("created") %>: <span data-audit-created>-</span></div>
        <div><%= t("updated") %>: <span data-audit-updated>-</span></div>
      </div>
      <div class="rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-xs text-rose-700" data-modal-error hidden></div>
      <div class="flex items-center gap-2">
        <button class="flex-1 rounded-xl bg-slate-900 px-4 py-3 text-xs font-semibold uppercase tracking-[0.2em] text-white transition hover:bg-slate-800 cursor-pointer" type="submit">
          <%= t("save") %>
        </button>
      </div>
    </form>
  </div>
</div>

<div class="fixed inset-0 z-50 hidden items-center justify-center bg-slate-900/40 p-4" data-confirm-modal>
  <div class="w-full max-w-md rounded-2xl border border-slate-200 bg-white shadow-xl">
    <div class="border-b border-slate-200 px-6 py-4">
      <div class="text-sm font-semibold text-slate-700" data-confirm-title><%= t("confirm") %></div>
      <p class="mt-1 text-xs text-slate-500" data-confirm-message><%= t("are_you_sure") %></p>
    </div>
    <form method="post" action="" class="space-y-4 px-6 py-5" data-confirm-form>
      <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
      <div class="flex items-center gap-2">
        <button class="flex-1 rounded-xl bg-slate-900 px-4 py-3 text-xs font-semibold uppercase tracking-[0.2em] text-white transition hover:bg-slate-800" type="submit">
          <%= t("continue") %>
        </button>
        <button class="flex-1 rounded-xl border border-slate-200 bg-white px-4 py-3 text-xs font-semibold uppercase tracking-[0.2em] text-slate-600 transition hover:border-slate-300 hover:text-slate-800" type="button" data-confirm-close>
          <%= t("cancel") %>
        </button>
      </div>
    </form>
  </div>
</div>

<%- include("../../base/partials/basic-info-utils", { t, page, basePath, modalOpen, modalMode }) %>
